---
title: "p8105_hw3_ys3924"
author: "YISU"
date: "2024-10-12"
output: github_document
---

```{r setup, include=FALSE}
library(p8105.datasets)
library(tidyverse)
library(ggplot2)
library(patchwork)
```

# Problem 1

### Read in and clean NY NOAA data
```{r}
data("ny_noaa") 
ny_noaa = ny_noaa |>
  janitor::clean_names() |> 
  separate(date, c('year', 'month', 'day'), sep ='-') |>
  mutate(prcp = as.numeric(prcp),
         tmax = as.numeric(tmax),
         tmin = as.numeric(tmin),
         year = as.numeric(year),
         prcp = prcp / 10,
         tmax = tmax / 10,
         tmin = tmin / 10)
ny_noaa_row = nrow(ny_noaa)
```


The dataset contains key variables id, date, prcp, snow, tmin, tmax. The dataset has `r ny_noaa_row` observations. There exists missing values for temperature, precipitation, or snowfall, which can affect analysis if not handled properly.


Count the snow fall
```{r}
snowfall_counts = ny_noaa |>
  count(snow) |>
  arrange(desc(n)) |>
  slice(1)
```

For snowfall, the most commonly observed values is 0, which contains 2008508 observations.



### Create plot showing the average max temperature in January and in July in each station across years

```{r, message=FALSE}
# Filter the data
jan_jul_temp = ny_noaa |>
  filter(month %in% c("01", "07")) |>
  group_by(id, year, month) |>
  drop_na(tmax) |>
  summarise(avg_max_temp = mean(tmax, na.rm = TRUE)) |>
  ungroup()

# Create the plot using the filtered data
  ggplot(jan_jul_temp, aes(x = year, y = avg_max_temp, color = id)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~month, scales = "free_y", labeller = labeller(month = c("01" = "January", "07" = "July"))) +
  labs(title = "Average Max Temperature of Stations in January and July across Years and Stations",
       x = "Year",  
       y = "Average Max Temperature") + 
  theme_minimal() +
  theme(legend.position = "none")
```

According to the above graph, average max temperature in July is higher than in January, and temperatures appear to be more consistent during July. The outliers exist for both January and July, where temperatures drop significantly below the typical range for most stations.


### Create plot showing tmax vs tmin and distribution of snowfall values 
```{r, warning=FALSE}
# Plot for tmax vs tmin  for the full dataset
plot_i = ggplot(ny_noaa, aes(x = tmin, y = tmax)) +
  geom_hex() +
  labs(title = "tmax vs tmin for the full Dataset", x = "Min Temperature", y = "Max Temperature") +
  theme_minimal()
# Plot for distribution of snowfall values
plot_ii = ny_noaa |>
  filter(snow > 0 & snow < 100) |>
  group_by(year) |>
  summarise(avg_snow = mean(snow, na.rm = TRUE)) |>
  ggplot(aes(x = year, y = avg_snow)) +
  geom_col(width = 0.7) +
  labs(title = "Snowfall Distribution by Year", x = "Year", y = "Average Snowfall") +
  theme_minimal()
plot_i + plot_ii
```